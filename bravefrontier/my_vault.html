<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Brave Frontier</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../css/w3.css">
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<script src="../js/ga.js"></script>
<script src="js/libs.js"></script>
<style>
a {
	text-decoration: none;
}
</style>
</head>

<body>
<!-- Navbar -->
<div class="w3-top">
  <ul class="w3-navbar w3-blue w3-left-align">
    <li class="w3-hide-medium w3-hide-large w3-opennav w3-right"> <a class="w3-hover-white" href="javascript:void(0);" onclick="openNav()"><i class="fa fa-bars"></i></a> </li>
    <li class="w3-hide-small"><a href="index.html" class="w3-hover-white"><i class="fa fa-home"></i></a></li>
    <li class="w3-hide-small"><a href="my_vault.html" class="w3-hover-white" onClick="addMode();"><i class="fa fa-plus"></i></a></li>
    <li class="w3-hide-small"><a href="my_vault.html" class="w3-hover-white" onClick="favMode();"><i class="fa fa-star"></i></a></li>
    <li class="w3-hide-small"><a href="my_vault.html" class="w3-hover-white" onClick="clearVault();">CLEAR VAULT!</a></li>
  </ul>
  
  <!-- Navbar on small screens -->
  <div id="navDemo" class="w3-hide w3-hide-large w3-hide-medium">
    <ul class="w3-navbar w3-blue w3-left-align">
      <li><a href="index.html"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="my_vault.html" onClick="addMode();"><i class="fa fa-plus"></i> Add View</a></li>
      <li><a href="my_vault.html" onClick="favMode();"><i class="fa fa-star"></i> Fav Mode</a></li>
      <li><a href="my_vault.html" onClick="clearVault();">CLEAR VAULT!</a></li>
    </ul>
  </div>
</div>
<!-- end Navbar --> 
<script>
// Used to toggle the menu on smaller screens when clicking on the menu button
function openNav() {
    var x = document.getElementById("navDemo");
    if (x.className.indexOf("w3-show") == -1) {
        x.className += " w3-show";
    } else { 
        x.className = x.className.replace(" w3-show", "");
    }
}
</script>
<div style="margin-top:40px;"></div>
<div class="w3-row"> 
  <!-- Left col -->
  <div class="w3-col" style="width:50%">
    <div id="left_list"> </div>
  </div>
  
  <!-- Right col -->
  <div class="w3-col" style="width:50%">
    <div id="right_content" style="height:126vh"> </div>
  </div>
</div>
<script>
	////////////
	if (typeof(Storage) !== "undefined") {
		if (!localStorage.mode) {
			localStorage.mode = 'add';
        }
		mode = localStorage.mode;
		
		if (!localStorage.myvault) {
			localStorage.myvault = '';
        }
		myvault = localStorage.myvault;
		
	} else {
		alert("Sorry, your browser does not support Web Storage...");
	}
	////////////
	var xmlhttp = new XMLHttpRequest();
	var url = "data/units.json";
	
	xmlhttp.onreadystatechange=function() {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			myFunction(xmlhttp.responseText);
		}
	}
	xmlhttp.open("GET", url, true);
	xmlhttp.send();
	
	function myFunction(response) {
		var arr = JSON.parse(response);
		var i;
		var out_left = "<div class='w3-center'>";
		var json_len = arr.brave.unit.length;
		myvault = localStorage.myvault
		var vault_array = myvault.split("|");
		var vault_unique = vault_array.filter( onlyUnique );
		var vault_len = vault_unique.length;
		
		for(i = 0; i < json_len; i++) {
			var id = arr.brave.unit[i].id;
			var thumb = arr.brave.unit[i].thumb['@path'];
			
			if(mode == 'add'){
				if(id != ""){
					out_left+='<img id="' + id + '" src="' + thumb + '" style="width:60px;margin-top:5px;cursor:pointer;" onClick="unitClickAdd(' + id + ')" > ';
				}
			}
			
			if(mode == 'fav'){
				for(j = 0; j < vault_len; j++) {
					if(id == vault_unique[j] && id != ""){
						out_left+='<img id="' + id + '" src="' + thumb + '" style="width:60px;margin-top:5px;cursor:pointer;" onClick="unitClickView(' + id + ')" > ';
					}
				}
			}

		}
		out_left+="</div>";
		document.getElementById("left_list").innerHTML = out_left;
	}
	
	/////////////////////
	function unitClickView(id){
		var path = 'unitinfo.html?id=' + id;
		var fullpath = '<iframe src="' + path +' " frameborder="0" width="100%" height="100%"></iframe>';
		document.getElementById("right_content").innerHTML = fullpath;
	}
	function unitClickAdd(id){
		myvault+= id + '|';
		localStorage.myvault = myvault;
		document.getElementById(id).style.display = 'none';
	}
	function clearVault(){
		if (confirm("Do you want to CLEAR YOUR VAULT?") == true) {
			localStorage.myvault = "";
		} else {
		}
	}
	function favMode(){
		if(mode == "add"){
			localStorage.mode = "fav";
			mode = localStorage.mode;
		}
	}
	function addMode(){
		if(mode == "fav"){
			localStorage.mode = "add";
			mode = localStorage.mode;
		}
	}
	//////////
	Array.prototype.remove = function() {
    var what, a = arguments, L = a.length, ax;
    while (L && this.length) {
        what = a[--L];
        while ((ax = this.indexOf(what)) !== -1) {
            this.splice(ax, 1);
        }
    }
    return this;
	};
	
	//var ary = ['three', 'seven', 'eleven'];
	//ary.remove('seven');
	////////////
	function onlyUnique(value, index, self) { 
    	return self.indexOf(value) === index;
	}
</script>
</body>
</html>
